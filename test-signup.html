<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Cadastro - ScribIA</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Teste de Cadastro ScribIA</h1>
    <div id="result"></div>
    
    <script>
        const SUPABASE_URL = "https://apnfbdkerddhkkzqstmp.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwbmZiZGtlcmRkaGtrenFzdG1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0ODg2NTUsImV4cCI6MjA3MDA2NDY1NX0.CVcB4Rr8KD0xE-70DcLH4ezuyPuscoulIrQpt2lY3D4";
        
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
        
        async function testSignup() {
            const testEmail = `teste${Date.now()}@example.com`;
            const testData = {
                email: testEmail,
                password: "123456",
                options: {
                    data: {
                        nome_completo: "Usuário Teste",
                        cpf: "123.456.789-00",
                        whatsapp: "(11) 99999-9999"
                    }
                }
            };
            
            console.log("Tentando cadastrar usuário:", testData);
            
            const { data, error } = await supabaseClient.auth.signUp(testData);
            
            if (error) {
                console.error("Erro no cadastro:", error);
                document.getElementById('result').innerHTML = `
                    <h2>Erro no cadastro:</h2>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                `;
            } else {
                console.log("Cadastro realizado:", data);
                document.getElementById('result').innerHTML = `
                    <h2>Cadastro realizado com sucesso!</h2>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                // Aguardar um pouco e verificar se o usuário foi criado na tabela
                setTimeout(async () => {
                    await checkUserInTable(data.user.id);
                }, 3000);
            }
        }
        
        async function checkUserInTable(userId) {
            console.log("Verificando usuário na tabela scribia_usuarios...");
            
            const { data, error } = await supabaseClient
                .from('scribia_usuarios')
                .select('*')
                .eq('id', userId);
            
            if (error) {
                console.error("Erro ao verificar usuário:", error);
                document.getElementById('result').innerHTML += `
                    <h3>Erro ao verificar usuário na tabela:</h3>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                `;
            } else {
                console.log("Usuário na tabela:", data);
                document.getElementById('result').innerHTML += `
                    <h3>Usuário na tabela scribia_usuarios:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            }
        }
        
        // Executar teste automaticamente
        testSignup();
    </script>
</body>
</html>